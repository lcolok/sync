'use strict'

// Á¶ÅÊ≠¢Âè≥ÈîÆËèúÂçï
document.oncontextmenu = function () { return false; };
// Á¶ÅÊ≠¢ÊñáÂ≠óÈÄâÊã©
// document.onselectstart = function(){ return false; };
// Á¶ÅÊ≠¢Â§çÂà∂
// document.oncopy = function(){ return false; };
// Á¶ÅÊ≠¢Ââ™Âàá
// document.oncut = function(){ return false; };
// Á¶ÅÊ≠¢Á≤òË¥¥
// document.onpaste = function(){ return false; };



var app = new Vue({
  el: '#app',

  data: () => ({
    user: null,

    maxItemsPerPage: 20,
    hasLoadedPages: 0,

    dropAndUploadDialog: {
      model: true,
      show: false
    },
    saveDesktopIconDialog: false,
    moreBottomSheet: false,

    progressDialog: {
      model: false,
      percent: 0,
    },
    loadingDialog: {},
    fileDescription: [
      {
        rule: ["mp4", "mov", "webm"],
        emoji: "üé¨",//Â∏∏ËßÑËßÜÈ¢ëÊñá‰ª∂
        type: "ËßÜÈ¢ë",
        size: '',
        icon: 'mdi-movie',
        canPlay: {
          icon: 'mdi-play',
          color: 'red',
        },
      },
      {
        rule: ["mkv", "avi", "flv"],
        emoji: "‚ñ∂Ô∏è",//Â∏∏ËßÑËßÜÈ¢ëÊñá‰ª∂
        type: "ÈùûÊ†áËßÜÈ¢ë",
        size: '',
        icon: 'mdi-file-video',
      },
      {
        rule: ["mp3", "ogg", "wav", "flac", "ape", "alca", "aac"],
        emoji: "üéµ",//Èü≥È¢ëÊñá‰ª∂
        type: "Èü≥È¢ë",
        size: '',
        icon: 'mdi-music',
      },
      {
        rule: ["png", "jpg", "bmp", "gif"],
        emoji: "üñºÔ∏è",//ÂõæÁâá
        type: "ÂõæÁâá",
        size: '',
        icon: 'mdi-file-image',
      },
      {
        rule: ["zip", "7z", "rar"],
        emoji: "üì¶",//ÂéãÁº©ÂåÖ
        type: "ÂéãÁº©ÂåÖ",
        size: '20',
        icon: 'fas fa-file-archive fa-xs',
      },
      {
        rule: ["dmg", "iso"],
        emoji: "üíΩ",//ÂÖâÁõòÊò†ÂÉè
        type: "ÂÖâÁõòÊò†ÂÉè",
        size: '',
        icon: 'mdi-harddisk',
      },
      {
        rule: ["ai", "psd", "aep"],
        emoji: "üìê",//Â∑•Á®ãÊñá‰ª∂
        type: "Â∑•Á®ãÊñá‰ª∂",
        size: '',
        icon: 'mdi-briefcase-edit',
      },
      {
        rule: ["ppt", "pptx", "key"],
        emoji: "üìΩÔ∏è",//ÊºîÁ§∫Êñá‰ª∂
        type: "ÊºîÁ§∫Êñá‰ª∂",
        icon: "mdi-projector-screen",
      },
      {
        rule: ["ttf", "otf"],
        emoji: "üî§Ô∏è",//Â≠ó‰ΩìÊñá‰ª∂
        type: "Â≠ó‰Ωì",
        size: '',
        icon: 'mdi-format-font',
      },
      {
        rule: ["doc", "pdf", "txt"],
        emoji: "üìÑ",//ÊñáÊ°£
        type: "ÊñáÊ°£",
        size: '',
        icon: 'mdi-file-pdf',
      },
      {
        rule: ["puppet"],
        emoji: "ü§ñ",//
        type: "Ch‰∫∫ÂÅ∂Ê®°Âûã",
        size: '',
        icon: 'mdi-robot',
      },
      {
        rule: [],
        emoji: "‚ùì",//Êú™Áü•Ê†ºÂºè
        type: "Êú™Áü•Ê†ºÂºè",
        size: '',
        icon: 'mdi-file-question',
      }
    ],

    direction: 'top',
    fab: true,
    fling: false,
    hover: true,
    tabs: null,
    top: false,
    right: true,
    bottom: true,
    left: false,
    transition: 'scale-transition',
    windowSize: {},

    floatBTN_Occur: 0,
    floatBTN: {
      fabs: [
        {
          icon: 'keyboard_arrow_up',
          small: true,
          color: 'orange',
          action() {
            app.$vuetify.goTo(0);
          }
        },
        {
          icon: 'mdi-cloud-upload',
          small: true,
          color: 'indigo',
          name: 'upload',
          action() {
            app.dropAndUploadDialog.show = true;
          }
        },
        {
          icon: 'search',
          small: true,
          color: 'green',
          action() {
            app.hoverOrNot();
            app.$refs.searchBar.focus();
          }
        },
      ]
    },

    originalName: '',
    renameInput: '',
    showMenuIndex: 'init',
    MenuX: 0,
    MenuY: 0,
    showMenu: false,
    renameDialog: false,
    deleteConfirmDialog: false,
    copyBtn: null, //Â≠òÂÇ®ÂàùÂßãÂåñÂ§çÂà∂ÊåâÈíÆ‰∫ã‰ª∂
    mobile: null,
    infoPanel: false,
    videoHeight: 0,
    videoWidth: 0,

    browserDialog: false,
    browserChoice: 'Chrome',
    browsers: [
      {
        name: 'Chrome',
        color: '',
        icon: 'mdi-google-chrome',

      },
      {
        name: 'Safari',
        color: '',
        icon: 'mdi-apple-safari',
      },
      {
        name: 'Firefox',
        color: '',
        icon: 'mdi-firefox',
      }
    ],

    moreBTN: {
      icon: 'mdi-settings', text: 'Êõ¥Â§öÊìç‰Ωú', moreBTN: true, showInSheet: true, action: () => {
        clearTimeout(app.moreBTNTimer);
        app.moreBTN.icon = 'mdi-settings mdi-spin';
        app.moreBTNTimer = setTimeout(() => {
          app.moreBTN.icon = 'mdi-settings';
        }, 360);//ÈΩøËΩÆËΩ¨Âä®


      }
    },
    bottomSheetToolbar: [
      {
        icon: 'mdi-clipboard-text', text: 'Â§çÂà∂Áü≠Èìæ', showInSheet: true, name: 'copyBTN', action: (result, e) => {
          clearTimeout(app.clipboardTimer);
          app.bottomSheetToolbar[0].icon = 'mdi-clipboard-check';
          app.clipboardTimer = setTimeout(() => {
            app.bottomSheetToolbar[0].icon = 'mdi-clipboard-text';
          }, 1000);

          // console.log(result);
        }

      },
      {
        icon: 'mdi-download', text: 'Áõ¥Êé•‰∏ãËΩΩ', showInSheet: true, action: (e) => {
          if (e.attributes) {
            var url = e.attributes.expandedURL ? e.attributes.expandedURL : e.attributes.uploaderURL;
            app.downloadStraightly(url);
            return
          }
          console.error('‰∏ãËΩΩÂ§±Ë¥•');
          // app.downloadStraightly(app.currentVideo.attributes.url);
        }
      },
      /*      {
             icon: 'mdi-cloud-upload', text: '‰∏ä‰º†‰∏ìÁî®', showInSheet: true, action: () => {
     
             }
           },
      */

      {
        icon: 'mdi-rename-box', text: 'ÈáçÂëΩÂêç', showInSheet: true, action: (renameOjbect, event) => {
          app.originalName = renameOjbect.attributes.name;
          app.renameOjbect = renameOjbect;
          console.log(event);
          app.renameInput = renameOjbect.get('name');
          app.renameDialog = true;
          setTimeout(() => {
            app.$refs.renameInput.focus();

          }, 0)
        }
      },
      {
        icon: 'mdi-comment-plus', text: 'Â§áÊ≥®', action: () => {

        }
      },
      {
        icon: 'mdi-link-box-variant-outline', text: 'Á∫ØÁü≠Èìæ', name: 'copyShortURL', action: () => {

        }
      },
      {
        icon: 'mdi-link-variant', text: 'Á∫ØÈïøÈìæ', name: 'copyLongURL', action: () => {

        }
      },
      /*       {
              icon: 'mdi-egg-easter', text: 'Ëé∑ÂèñID', name: 'getID', action: () => {
      
              }
            }, */
      {
        icon: 'mdi-delete', text: 'Âà†Èô§ËØ•È°π', subheader: 'ÊïèÊÑüÊìç‰Ωú', action: (deleteOjbect) => {
          app.deleteOjbect = deleteOjbect;
          app.deleteConfirmDialog = true;
        }
      },


    ],
    generalMenu: [
      {
        icon: 'mdi-page-previous', text: 'ÂõûÂà∞ÊóßÁâà', action: () => {
          var currentURL = window.location.href;
          if (currentURL.match(/\?/)) {
            console.log(currentURL.split('?')[0]);
            return window.location.href = currentURL.split('?')[0] + 'oldver';
          } else { return window.location.href = (window.location.href + 'oldver'); }
        }
      },
      {
        icon: 'mdi-file-upload', text: 'Áü≥Â¢®ÊñáÊ°£‰∏ä‰º†', tip: 'Â∞Ü‰ºöÊâìÂºÄÁü≥Â¢®ÁöÑÈ°µÈù¢ËøõË°å‰∏ä‰º†(ÈúÄË¶ÅË¥≠‰π∞‰ºöÂëòÊâçËÉΩ‰∏ä‰º†10M‰ª•‰∏äÁöÑÊñá‰ª∂)', action: () => {
          window.open('https://shimo.im/docs/K8CWmBMqMtYYpU1f');
        }
      },
      {
        icon: 'mdi-cloud-upload', text: '‰∏ä‰º†È°µÈù¢', tip: 'Â∞Ü‰ºöÊâìÂºÄ‰∏Ä‰∏™ÂèçÂêë‰ª£ÁêÜÁöÑ‰∏ä‰º†È°µ(100M‰ª•ÂÜÖÁöÑÊñá‰ª∂Â∫îËØ•ÈÉΩÊó†ÂéãÂäõÁöÑ)', action: () => {
          window.open((window.location.href + 'uploadPage'));
        }
      },
      {
        icon: 'mdi-database-edit', text: 'Êï∞ÊçÆÁÆ°ÁêÜ', action: () => {
          window.open('https://leancloud.cn/dashboard/data.html?appid=Km0N0lCryHeME8pYGOpOLag5-gzGzoHsz#/ShimoBed')
        }
      },
      {
        icon: 'mdi-share', text: 'ÂàÜ‰∫´ÁΩëÂùÄ', name: 'shareThisApp', action: () => {

        }
      },
      {
        icon: 'mdi-apple-safari', text: 'Ê°åÈù¢ÂõæÊ†á',
        hide: () => {//Â°´ÂÜôÈöêËóèËßÑÂàô
          return !window.navigator.standalone//Ê£ÄÊµãÊòØÂê¶ÂÖ®Â±è(ÊòØÂê¶Âú®PWAÁä∂ÊÄÅ‰∏ãÊâìÂºÄ)
        },
        action: () => {
          // window.location.href='mqqapi://';//ÊâìÂºÄQQ
          // var encodedURL = encodeURIComponent("https://www.baidu.com");
          // window.location.href = `x-web-search://?${encodedURL}`
          app.browserDialog = true;
          // window.location.href = 'addIcon/saveAsSafari.html';
        }
      },
      {
        icon: 'mdi-logout', text: 'ÂÆâÂÖ®ÁôªÂá∫', action: () => {
          app.logOut();
        }
      }
    ],
    tabs: null,
    mainView: true,
    dark: false,
    bottomSheet: false,
    floatPlayBTN_Occur: false,
    currentVideo: { attributes: {} },
    searchDuration: 0,
    keywordLasttime: null,
    resultSumLasttime: null,
    typeList: [/* 

      {
        size: '20', icon: 'fas fa-globe-americas', text: 'ÂÖ®ÈÉ®'
      },
      { size: '', icon: 'mdi-movie', text: 'ËßÜÈ¢ë' },
      { size: '', icon: 'mdi-music', text: 'Èü≥‰πê' },
      { size: '', icon: 'mdi-image-area', text: 'ÂõæÁâá' },
      { size: '', icon: 'mdi-file-pdf', text: 'PDF' },
      { size: '20', icon: 'fas fa-file-archive fa-xs', text: 'ÂéãÁº©ÂåÖ' },

     */],
    mainList: {
      selected: [],
      results: [
        /*         {
                  icon: 'video_library',
                  iconClass: 'green lighten-1 white--text',
                  action: '15 min',
                  headline: 'Brunch this weekend?',
                  name: 'Ali Connors',
                  subtitle: "I'll be in your neighborhood doing errands this weekend. Do you want to hang out?"
                },
                {
                  icon: 'library_music',
                  iconClass: 'grey lighten-1 white--text',
                  action: '2 hr',
                  headline: 'Summer BBQ',
                  name: 'me, Scrott, Jennifer',
                  subtitle: "Wish I could come, but I'm out of town this weekend."
                },
                {
                  icon: 'assignment',
                  iconClass: 'blue white--text',
                  action: '6 hr',
                  headline: 'Oui oui',
                  name: 'Sandra Adams',
                  subtitle: 'Do you have Paris recommendations? Have you ever been?'
                },
                {
                  icon: 'call_to_action',
                  iconClass: 'amber white--text',
                  action: '12 hr',
                  headline: 'Birthday gift',
                  name: 'Trevor Hansen',
                  subtitle: 'Have any ideas about what we should get Heidi for her birthday?'
                },
                {
                  icon: 'picture_as_pdf',
                  iconClass: 'grey lighten-1 white--text',
                  action: '18hr',
                  headline: 'Recipe to try',
                  name: 'Britta Holt',
                  subtitle: 'We should eat this: Grate, Squash, Corn, and tomatillo Tacos.'
                } */
      ]
    }
    ,
    drawers: ['Default (no property)', 'Permanent', 'Temporary'],
    searchType: {
      items: ['ËßÜÈ¢ë', 'Èü≥È¢ë', 'ÂõæÁâá', 'ÊñáÊ°£', 'ÂéãÁº©ÂåÖ', 'ËΩØ‰ª∂', 'ÂπªÁÅØÁâá'],
      value: []
    },
    snackbar: {


    },
    tempPlayingID: '',
    primaryDrawer: {
      model: false,//ÂÜ≥ÂÆö‰∏ÄÂºÄÂßãÊòØÂ±ïÂºÄÁä∂ÊÄÅËøòÊòØÊäòÂè†Áä∂ÊÄÅ
      type: 'default (no property)',
      clipped: false,
      floating: false,
      mini: false,

    },
    footer: {
      inset: false
    },
    searchLoading: false,
    keyword: '',
    custom: true,
    loader: null,
    loading: false,
    loading2: false,
    loading3: false,
    loading4: false,
    alert: true,
    scrollStyle: "",
    paste: true,
    videoImage: {},
    rules: {
      required: value => !!value || 'ÂøÖÂ°´‰ø°ÊÅØ',
      counter: value => (value == null ? 0 : value.length) <= 20 || 'ÊúÄÂ§öÂè™ËÉΩÂ°´ÂÜô20‰∏™Â≠óÁ¨¶',
      email: value => {
        const pattern = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
        return pattern.test(value) || 'Invalid e-mail.'
      },
      entropy: (value) => {
        var shannonEntropy = newEntropy(value).toString();
        console.log(shannonEntropy);
        return `‰ø°ÊÅØÁÜµ:${shannonEntropy}`
      }
    },
    arrowDegree: 0,
  }),
  computed: {
    layoutAttributes() {
      var BPN = this.$vuetify.breakpoint.name;
      console.log(BPN);
      switch (BPN) {
        case 'xs':
          return { 'justify-space-between': true };
        default:
          return { 'jusetify-begin': true };
      }
    },
    activeFab() {
      switch (this.fab) {
        case true: return { color: 'red', icon: 'close' }
        case false: return { color: "blue darken-2", icon: 'more_horiz' }
        default: return {}
      }
    },
    backToSearchTarget() {
      return app.$refs.searchBar.focus();
    },
    backToSearchOptions() {
      return {
        offset: 16,
        duration: 300,
        easing: 'easeInOutCubic'
      }
    },
    style() {
      return { transform: 'rotate(' + this.arrowDegree / 360 + 'turn)' }
    },
    innerHeight() {
      return window.innerHeight * 0.8;
    },
    progress() {
      var num = this.keyword == null ? 0 : this.keyword.length;
      return Math.min(100, num * 10)
    },
    color() {
      return ['error', 'warning', 'success'][Math.floor(this.progress / 40)]
    },
    searchRange() {
      var all = this.searchType.value.join('|');

      if (all.length > 4) {
        all = all.slice(0, 4) + '...'
      }
      return all;
    },
    showArrow() {
      if (this.mobile) { return false } else { return true }
    },
    videoView() {
      var H = this.mobile ? 180 : 600;
      var rate = 16 / 9;
      var W = H * rate;
      var W = (W < window.innerWidth) ? window.innerWidth : W;

      return {
        height: H,
        width: W
      }
    },
  },
  created() {

    this.autoLogin();
    this.captchaInit();
    this.shimoData = AV.Cloud.run('updateShimo');

  },
  mounted() {
    if (this.user) {

      this.getScrollStyle();
      this.initPlayers();
      this.initPasteEvent();
      this.initFilePond();
      this.initDropFiled();
      this.initMiniRefresh();
      //Â§ÑÁêÜParams
      // this.getQ() ? 0 : (this.getV() ? 0 : (this.getID() ? 0 : this.searchGlobal('')))
      var param = this.getUrlVars();
      if (param !== {}) {
        if (param.q) { return this.getQ(param.q) };
        if (param.v) { return this.getV(param.v) };
        if (param.id) { return this.getID(param.id) };
        if (param.b && (!window.navigator.standalone)) { return this.getB(param.b) };//Ê£ÄÊµãÊòØÂê¶Â∏¶bÂèÇÊï∞,Âπ∂‰∏îÊòØÂê¶Âú®ÂÖ®Â±èÁä∂ÊÄÅ‰∏ã(ÊòØÂê¶Âú®PWAÁä∂ÊÄÅ‰∏ãÊâìÂºÄ)
      }

      if (this.searchGlobal('')) { return };

    }
  },
  watch: {
    typeList(val) {
      this.typeListSorted = val.slice().sort((a, b) => {
        return b.count - a.count
      });
    },
    renameDialog(val) {
      if (val) {
        app.removePasteEvent();
      } else {
        app.initPasteEvent();
      }
    },
    'primaryDrawer.model'(val) {
      if (val) return;
      if (!tempPlayingID) return;

      this.getID(tempPlayingID);
    },
    'user.objectId': {
      handler: function (id) {
        if (id) {
          console.log(id);
        } else {

        }
      },
    },
    bottomSheet() {
      if (this.bottomSheet == false) {
        this.dpFloat.pause();
      } else {
        this.floatPlayBTN_Occur = true;
        this.dpFloat.play();
      }

    },
    loadingDialog(val) {
      if (!val) return
      console.log(val);
      // setTimeout(() => (this.loadingDialog = false), 4000)
    },
    /*     loader() {
          var _this = this;
          var l = this.loader;
          this[l] = !this[l];
    
          setTimeout(function () { return _this[l] = false; }, 3000);
    
          this.loader = null;
        } */
  },
  methods: {
    /*     screenSizeStatus() {
          console.log(this.$vuetify.breakpoint.name);
          switch (this.$vuetify.breakpoint.name) {
            case 'xs': return '220px';
            case 'sm': return '400px';
            case 'md': return '500px';
            case 'lg': return '600px';
            case 'xl': return '800px';
          }
        }, */
    initMiniRefresh() {
      var miniRefresh = new MiniRefresh({
        container: '#minirefresh',
        down: {
          // isAuto: true,
          callback: async function () {
            // ‰∏ãÊãâ‰∫ã‰ª∂ Âà∑Êñ∞
            console.log('Ê≠£Âú®‰∏ãÊãâ');
            // window.location.reload();//È°µÈù¢Âà∑Êñ∞
            await app.regularCheckUpdate();
            miniRefresh.endDownLoading();
          }
        },
        up: {

          callback: function () {
            // ‰∏äÊãâ‰∫ã‰ª∂
            console.log('Ê≠£Âú®‰∏äÊãâ');
            miniRefresh.endUpLoading(true);
          }
        }
      });
    },
    pasteToSearchBar(event) {
      /*       var pasteText = document.getElementById("searchBar");
            pasteText.focus();
            document.execCommand("paste");
            console.log(pasteText.textContent); */
      var clipboardData = event.clipboardData || window.clipboardData;
      return clipboardData.getData("text");
    }
    ,
    initDropFiled() {
      //ÊãñÊãΩÁöÑÁõÆÊ†áËäÇÁÇπ
      var dropZone = document.getElementById('app');


      function showDropZone() {
        console.log("visible");
        app.dropAndUploadDialog.show = true;

        // dropZone.style.visibility = "visible";
      }
      function hideDropZone() {
        console.log("hidden");
        app.dropAndUploadDialog.show = false;
        // dropZone.style.visibility = "hidden";
      }

      function allowDrag(e) {
        if (true) {
          // Test that the item being dragged is a valid one
          e.dataTransfer.dropEffect = 'copy';
          e.preventDefault();
        }
      }

      function handleDrop(e) {
        if (app.timerCloseDialog) { clearTimeout(app.timerCloseDialog); }
        e.preventDefault();

        // hideDropZone();

        console.log(e);
      }

      // ÁõëÂê¨widow‰∏äÁöÑ‰∫ã‰ª∂
      window.addEventListener('dragenter', function (e) {
        showDropZone();
      });

      dropZone.addEventListener('dragenter', allowDrag);
      dropZone.addEventListener('dragover', allowDrag);

      dropZone.addEventListener('dragover', () => {
        if (app.timerCloseDialog) { clearTimeout(app.timerCloseDialog); }
        app.timerCloseDialog = setTimeout(() => {
          hideDropZone();
        }, 500)
      });

      // dropZone.addEventListener('dragleave', hideDropZone);

      // document.getElementById('filepond').addEventListener('dragleave', hideDropZone);

      dropZone.addEventListener('drop', handleDrop);
    },
    initFilePond() {
      const inputElement = document.querySelector('input[type="file"]');
      const inputElement2 = document.getElementById('filepond2');

      FilePond.registerPlugin(
        FilePondPluginImagePreview,
        FilePondPluginImageExifOrientation,
        // FilePondPluginFilePoster
      );

      console.log(inputElement);

      // create a FilePond instance at the input element location
      const pond = FilePond.create(inputElement, {
        server: {
          process: async (
            fieldName,
            file,
            metadata,
            load,
            error,
            progress,
            abort
          ) => {
            console.log(file);

            var QJ = await AV.Cloud.run("getQiniuJSON", {
              fileNameArr: [file.name]
            });

            console.log(QJ);

            var observer = {
              next(res) {
                var e = res.total;
                console.log(e);
                progress(true, e.loaded, e.size);
              },
              error(err) {
                console.error(err);
                error(err);
              },
              complete(res) {
                console.log(res);
                if (res.code == 0) {

      
                  var json = res;
                  console.log(json);
                  var filename = file.name;

                  var arr = filename.split('.');
                  var suffix = arr.pop();
                  var realName = arr.join('.');

                  json.data.suffix = suffix;
                  json.data.name = realName;

                  AV.Cloud.run('updateShimo', json);

                  load(res); //ÂÆåÊàêÂêéÔºåÂ∫îËØ•Áî®Êñá‰ª∂ÂØπË±°ÊàñblobË∞ÉÁî®loadÊñπÊ≥ï loadÊñπÊ≥ïÊé•ÂèóÂ≠óÁ¨¶‰∏≤(id)ÊàñÂØπË±°
                }

              }
            };

            var putExtra = {
              fname: "", //fname: stringÔºåÊñá‰ª∂ÂéüÊñá‰ª∂Âêç
              params: {}, //params: objectÔºåÁî®Êù•ÊîæÁΩÆËá™ÂÆö‰πâÂèòÈáè
              mimeType: null //mimeType: null || arrayÔºåÁî®Êù•ÈôêÂà∂‰∏ä‰º†Êñá‰ª∂Á±ªÂûãÔºå‰∏∫ null Êó∂Ë°®Á§∫‰∏çÂØπÊñá‰ª∂Á±ªÂûãÈôêÂà∂ÔºõÈôêÂà∂Á±ªÂûãÊîæÂà∞Êï∞ÁªÑÈáåÔºö["image/png", "image/jpeg", "image/gif"]
            };

            var config = {
              // useCdnDomain: true,//Ë°®Á§∫ÊòØÂê¶‰ΩøÁî® cdn Âä†ÈÄüÂüüÂêçÔºå‰∏∫Â∏ÉÂ∞îÂÄºÔºåtrue Ë°®Á§∫‰ΩøÁî®ÔºåÈªòËÆ§‰∏∫ false„ÄÇÔºàÊÑüËßâÂºÄÂêØ‰∫Ü‰πãÂêéÔºå‰∏ä‰º†ÁöÑÈÄüÂ∫¶Êõ¥ÊÖ¢‰∫ÜÔºâ
              concurrentRequestLimit: 9 //ÂàÜÁâá‰∏ä‰º†ÁöÑÂπ∂ÂèëËØ∑Ê±ÇÈáèÔºånumberÔºåÈªòËÆ§‰∏∫3ÔºõÂõ†‰∏∫ÊµèËßàÂô®Êú¨Ë∫´‰πü‰ºöÈôêÂà∂ÊúÄÂ§ßÂπ∂ÂèëÈáèÔºåÊâÄ‰ª•ÊúÄÂ§ßÂπ∂ÂèëÈáè‰∏éÊµèËßàÂô®ÊúâÂÖ≥„ÄÇ
            };

            var observable = qiniu.upload(
              file,
              QJ[0].key,
              QJ[0].token,
              putExtra,
              config
            );
            var subscription = observable.subscribe(observer); // ‰∏ä‰º†ÂºÄÂßã
            // or
            //   var subscription = observable.subscribe(next, error, complete); // ËøôÊ†∑‰º†ÂèÇÂΩ¢Âºè‰πüÂèØ‰ª•

            return {
              abort: () => {
                // Â¶ÇÊûúÁî®Êà∑ÁÇπÂáª‰∫ÜÂèñÊ∂àÊåâÈíÆÔºåÂàôËøõÂÖ•ËØ•ÂäüËÉΩ
                subscription.unsubscribe(); // ‰∏ä‰º†ÂèñÊ∂à

                //ËÆ©filepondÁü•ÈÅìËØ∑Ê±ÇÂ∑≤Ë¢´ÂèñÊ∂à
                abort();
              }
            };
          }
        },
        dropOnPage: true,

        //‰ª•‰∏ã‰∏∫Êú¨Âú∞Âåñ
        labelIdle: 'ÊãñÊîæÊñá‰ª∂‰∫éÊ≠§ÊàñËÄÖ<span class="filepond--label-action"> ÊµèËßàÊú¨Âú∞ </span>',
        labelInvalidField: 'Â≠óÊÆµÂåÖÂê´Êó†ÊïàÊñá‰ª∂',
        labelFileWaitingForSize: 'Ê≠£Âú®ËÆ°ÁÆóÂ§ßÂ∞è',
        labelFileSizeNotAvailable: 'Êú™Áü•Â§ßÂ∞è',
        labelFileLoading: 'ËΩΩÂÖ•‰∏≠',
        labelFileLoadError: 'Âä†ËΩΩÂá∫Èîô',
        labelFileProcessing: '‰∏ä‰º†‰∏≠',
        labelFileProcessingComplete: '‰∏ä‰º†ÂÆåÊàê',
        labelFileProcessingAborted: '‰∏ä‰º†Â∑≤ÂèñÊ∂à',
        labelFileProcessingError: '‰∏ä‰º†Êó∂Âá∫Èîô',
        labelFileProcessingRevertError: 'ËøòÂéüÊó∂Âá∫Èîô',
        labelFileRemoveError: 'Âà†Èô§Êó∂Âá∫Èîô',
        labelTapToCancel: 'ÁÇπÂáªÂèñÊ∂à',
        labelTapToRetry: 'ÁÇπÂáªÈáçËØï',
        labelTapToUndo: 'ÁÇπÂáªÊí§Âõû',
        labelButtonRemoveItem: 'ÁßªÈô§',
        labelButtonAbortItemLoad: '‰∏≠Ê≠¢',
        labelButtonRetryItemLoad: 'ÈáçËØï',
        labelButtonAbortItemProcessing: 'ÂèñÊ∂à',
        labelButtonUndoItemProcessing: 'Êí§Âõû',
        labelButtonRetryItemProcessing: 'ÈáçËØï',
        labelButtonProcessItem: '‰∏ä‰º†',
      });
    },

    isMobileSafari() {
      var ua = navigator.userAgent;

      // IOSÁ≥ªÁªü
      if (/ OS \d/.test(ua)) {
        // ‰∏çÊòØChrome
        if (!~ua.indexOf('CriOS')) {
          // ÂºÄÂ§¥ÂøÖÈ°ª‰∏∫Mozilla
          if (!ua.indexOf('Mozilla')) {
            // ÁªìÂ∞æÈúÄ‰∏∫ÔºöSafari/xxx.xx
            if (/Safari\/[\d\.]+$/.test(ua)) {
              return true;
            }
          }
        }
      }
      return false;
    },
    saveDesktopIcon(browser) {
      browser = browser.toLowerCase();
      if (browser == 'safari' && this.isMobileSafari()) {
        this.browserDialog = false;
        this.saveDesktopIconDialog = true;
        return
      }
      window.location.href = `addIcon/?browser=${browser}`;
      return
    },
    autoLogin() {
      var user = AV.User.current()
      if (user) {
        // user.isAuthenticated().then(function(authenticated) {
        //   if (authenticated) {
        this.user = user.toJSON()
        //   }
        // }
      }
    },
    captchaInit() {
      AV.Captcha.request().then(function (captcha) {
        // console.log(captcha);
        // console.log(app.$refs.captchaImage);
        captcha.bind({
          textInput: 'captchaCode', // the id for textInput
          image: 'captchaImage',    // the id for image element
          verifyButton: 'verify',    // the id for verify button
        }, {
            success: function (validateCode) {
              console.log('È™åËØÅÊàêÂäüÔºå‰∏ã‰∏ÄÊ≠•')
            },
            error: function (error) {
              console.error(error.message)
            },
          });
      });
    },
    logOut: function () {
      AV.User.logOut()
      this.user = null;
    },
    signUp() {

      var username = $('#inputUsername').val();
      var password = $('#inputPassword').val();
      var email = $('inputEmail').val();

      // LeanCloud - Ê≥®ÂÜå
      // https://leancloud.cn/docs/leanstorage_guide-js.html#Ê≥®ÂÜå
      var user = new AV.User();
      user.setUsername(username);
      user.setPassword(password);
      user.setEmail(email);
      user.signUp().then(function (user) {
        // Ê≥®ÂÜåÊàêÂäü
        console.log(user);
        app.user = user.toJSON();

      }).catch(alert);
    },
    login() {
      var username = $('#inputUsername').val();
      var password = $('#inputPassword').val();

      // LeanCloud - ÁôªÂΩï
      // https://leancloud.cn/docs/leanstorage_guide-js.html#Áî®Êà∑ÂêçÂíåÂØÜÁ†ÅÁôªÂΩï
      AV.User.logIn(username, password).then(function (user) {
        // ÁôªÂΩïÊàêÂäü
        console.log(user);
        app.user = user.toJSON();
        console.log(app.user);
      }).catch(alert);
    },
    copySuccess(e) {
      /* app.snackbar.show = false;

      app.snackbar = {
        show: true,
        color: 'success',
        ripple: false,
        snackbarText: 'Â∑≤Â§çÂà∂',
        snackbarIcon: 'file_copy',
        action: () => {

        }
      } */
      e = e ? e : 'Â∑≤Â§çÂà∂'
      app.$message.success(e);
      sfx.play('https://uploader.shimo.im/f/YOwjiyzl4Kk0Dd5H.mp3?attname=Paste_Copy.mp3');
    },


    pasteEventHandler(e) {
      var cbd = e.clipboardData;
      var ua = window.navigator.userAgent;

      // Â¶ÇÊûúÊòØ Safari Áõ¥Êé• return
      if (!(e.clipboardData && e.clipboardData.items)) {
        return;
      }

      // MacÂπ≥Âè∞‰∏ãChrome49ÁâàÊú¨‰ª•‰∏ã Â§çÂà∂Finder‰∏≠ÁöÑÊñá‰ª∂ÁöÑBug HackÊéâ
      if (cbd.items && cbd.items.length === 2 && cbd.items[0].kind === "string" && cbd.items[1].kind === "file" &&
        cbd.types && cbd.types.length === 2 && cbd.types[0] === "text/plain" && cbd.types[1] === "Files" &&
        ua.match(/Macintosh/i) && Number(ua.match(/Chrome\/(\d{2})/i)[1]) < 49) {
        return;
      }

      /* for (var i = 0; i < cbd.items.length; i++) {
        var item = cbd.items[i];
        console.log(item.kind);
        switch (item.kind) {
          case "file":
            var blob = item.getAsFile();
            console.log(blob);
            // blob Â∞±ÊòØ‰ªéÂâ™ÂàáÊùøËé∑ÂæóÁöÑÊñá‰ª∂ ÂèØ‰ª•ËøõË°å‰∏ä‰º†ÊàñÂÖ∂‰ªñÊìç‰Ωú
            break;
          case "string":
            item.getAsString((text) => {
              console.log(text);
              return
              app.searchGlobal(text);
            })
 
            break;
        }
      } */
      for (var i = 0, unikind; i < cbd.items.length; i++) {
        var item = cbd.items[i];
        if (!unikind) {
          unikind = item.kind;
        }
        if (i == cbd.items.length - 1) {
          console.log(`${i}È°πÂÖ®ÈÉ®ÈÉΩÊòØ${unikind}`);
          if (unikind == 'string') {
            /* for (var j = 0; j < cbd.items.length; j++) {
              var item = cbd.items[j];
              console.log(item.kind);
              var k = 0;
              if (j !== 0) {
                item.getAsString((text) => {
                  console.log(`ËøôÊòØÁ¨¨${k}È°πÁõÆÁöÑËß£ÊûêÁªìÊûú:${text}`);
                  k++;
                  return
                  app.searchGlobal(text);
                })
              }
            } */
            cbd.items[0].getAsString((text) => {
              app.searchGlobal(text);
            })
          }
        }

        if (unikind == item.kind) { continue; } else {
          break;
        }
      }


      // e.preventDefault();//ËøôÂè•ÂèØ‰ª•ÂØºËá¥Á≤òË¥¥‰∏çÊàêÂäü

    }
    ,
    initPasteEvent() {
      document.addEventListener("paste", this.pasteEventHandler, false);//ÂàùÂßãÂåñpaste‰∫ã‰ª∂ÁõëÂê¨
    },
    removePasteEvent() {
      document.removeEventListener("paste", this.pasteEventHandler, false);//ÁßªÈô§Á≤òË¥¥‰∫ã‰ª∂ÁöÑÁõëÂê¨
    },
    hoverOrNot() {
      this.hover = false;
      setTimeout(() => {
        this.hover = true;
      }, 800);
    },
    loadMoreItems: async function () {
      var realThis = this;
      return new Promise(async function (resolve, reject) {
        var query = new AV.Query('ShimoBed');
        query.descending("updatedAt");
        query.limit(realThis.maxItemsPerPage * (realThis.hasLoadedPages + 1));//ËØ∑Ê±ÇÊï∞Èáè‰∏äÈôê‰∏∫1000Êù°
        var every = await query.find();
        console.log(every);
        app.mainList.results = app.makeAList(every);
        if (every) {
          resolve(every);
        } else {
          reject("Ê≤°ÊúâËøîÂõûÁªìÊûú");
        }
      });
    },
    autoLoad() {
      if (app.keywordLasttime) { return }

      //ÂèòÈáèscrollTopÊòØÊªöÂä®Êù°ÊªöÂä®Êó∂ÔºåË∑ùÁ¶ªÈ°∂ÈÉ®ÁöÑË∑ùÁ¶ª
      var scrollTop = document.documentElement.scrollTop || document.body.scrollTop || window.pageYOffset;
      //ÂèòÈáèwindowHeightÊòØÂèØËßÜÂå∫ÁöÑÈ´òÂ∫¶
      var windowHeight = document.documentElement.clientHeight || document.body.clientHeight;
      //ÂèòÈáèscrollHeightÊòØÊªöÂä®Êù°ÁöÑÊÄªÈ´òÂ∫¶
      var scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
      //ÊªöÂä®Êù°Âà∞Â∫ïÈÉ®ÁöÑÊù°‰ª∂
      var offset = 200;
      if ((scrollTop + windowHeight + offset >= scrollHeight) && !this.loadingItems) {//Â¶ÇÊûúÂ∑≤ÁªèËøõË°åËøáÊêúÁ¥¢ÁöÑËØù,Â∞±‰∏ç‰ºöËøõË°åËá™Âä®Âä†ËΩΩ
        //ÂÜôÂêéÂè∞Âä†ËΩΩÊï∞ÊçÆÁöÑÂáΩÊï∞
        // console.log("Ë∑ùÈ°∂ÈÉ®" + scrollTop + "ÂèØËßÜÂå∫È´òÂ∫¶" + windowHeight + "ÊªöÂä®Êù°ÊÄªÈ´òÂ∫¶" + scrollHeight);
        app.loadingDialog = {
          model: true,
          text: 'Ê≠£Âú®Âä†ËΩΩÊõ¥Â§öÈ°πÁõÆ...'
        };

        this.loadingItems = true;
        this.hasLoadedPages++;
        this.loadMoreItems().then(() => {
          this.loadingItems = false;
          app.loadingDialog.model = false;
        });
      }
    },

    occurFab() {
      var scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;
      /*       console.log(`Â∑≤ÁªèÊªöÂä®Ôºö${scrollTop}`);
            console.log(`Á™óÂè£È´òÂ∫¶Ôºö${window.innerHeight}`);
            console.log(`‰∏§ËÄÖ‰πãÂ∑ÆÔºö${window.innerHeight - scrollTop}`); */
      this.windowSize = { x: window.innerWidth, y: window.innerHeight }
      if (scrollTop > this.windowSize.y * 0.1) {
        this.floatBTN_Occur = 1;
        return 1
      } else {
        this.fab = false;//Á°Æ‰øùÊµÆÂä®ÊåâÈíÆÊ∂àÂ§±ÁöÑÊó∂ÂÄô,ÂºπÂá∫Êù•ÁöÑÊåâÈíÆ‰πüÊòØÊî∂Ëµ∑Áä∂ÊÄÅ
        this.floatBTN_Occur = 0;
        return 0
      }
    },
    rightClick(index, e) {
      // e.preventDefault()
      // console.log(e);
      // this.showMenu = false
      // this.MenuX = e.clientX
      // this.MenuY = e.clientY
      // this.$nextTick(() => {
      //   this.showMenu = true
      // })

      e.preventDefault()
      // console.log(index);
      this.showMenu = false;
      this.showMenuIndex = index;
      this.MenuX = e.clientX;
      this.MenuY = e.clientY;


      this.$nextTick(() => {
        this.showMenu = true;
      })
      setTimeout(() => {
        this.initClipboardJS();
      }, 0);

    },
    focusOrNot(event) {
      if (app.originalName !== app.renameInput) {
        event.target.select();
        app.originalName = app.renameInput;
      }

    },
    renameContent: async function (currentVideo) {
      if (app.renameInput !== app.originalName) {
        var renameObject = AV.Object.createWithoutData('ShimoBed', currentVideo.id);
        renameObject.set('name', app.renameInput);
        renameObject.save().then(function (renameObject) {
          currentVideo.attributes.name = app.renameInput;//Âà∑Êñ∞Âú®Â±èÂπï‰∏äÊòæÁ§∫ÁöÑÂêçÁß∞
          app.$message.success(`„Äå${app.originalName}„ÄçÂ∑≤ÈáçÂëΩÂêç‰∏∫„Äå${app.renameInput}„Äç`);
          // ÊàêÂäü‰øùÂ≠ò‰πãÂêéÔºåÊâßË°åÂÖ∂‰ªñÈÄªËæë.
        }).catch((err) => {
          app.$message.error(`ÂèëÁîüÈîôËØØ:${err}`);
        })
        return
      }
      console.log('ÂêçÂ≠óÊ≤°ÊúâÊõ¥Êîπ');
    },
    deleteContent: async function (currentVideo) {
      console.log(currentVideo);
      if (currentVideo.id) {
        console.log(currentVideo.attributes.id);
        AV.Cloud.run('deleteContent', {
          id: currentVideo.attributes.id,
        });
        AV.Object.createWithoutData('ShimoBed', currentVideo.id)
          .destroy()
          .then(function () {

            app.mainList.results.splice(app.mainList.results.indexOf(currentVideo), 1)
            app.bottomSheet = false;
          })
          .catch((err) => { console.log(err); });

      } else {
        console.error("Ê≤°ÊúâÁü≥Â¢®ËØÑËÆ∫idÂè∑,Êó†Ê≥ïÂà†Èô§!");
      }
    },
    downloadStraightly(uploaderURL) {
      var downloadURL = uploaderURL + '?download';
      // console.log(app.currentVideo.url);
      window.location.href = downloadURL;
    },

    renameDownload(url, filename) {


      function updateProgress(evt) {
        if (evt.lengthComputable) {  //evt.loaded the bytes browser receive
          //evt.total the total bytes seted by the header
          //
          var percentComplete = (evt.loaded / evt.total) * 100;

          var density = 5;//ËøõÂ∫¶Êù°ËøêÂä®ÂØÜÂ∫¶
          app.progressDialog.percent = Math.floor(percentComplete / density) * density;
          // console.log(app.progressDialog.percent);
          // $('#progressbar').progressbar("option", "value", percentComplete);
        }
      }



      /**
 * Ëé∑Âèñ blob
 * @param  {String} url ÁõÆÊ†áÊñá‰ª∂Âú∞ÂùÄ
 * @return {Promise} 
 */
      function getBlob(url) {
        return new Promise(resolve => {
          const xhr = new XMLHttpRequest();

          xhr.onprogress = updateProgress;
          xhr.open('GET', url, true);
          xhr.responseType = 'blob';
          xhr.onload = () => {
            if (xhr.status === 200) {
              resolve(xhr.response);
            }
          };

          xhr.send();
        });
      }

      /**
      * ‰øùÂ≠ò
      * @param  {Blob} blob     
      * @param  {String} filename ÊÉ≥Ë¶Å‰øùÂ≠òÁöÑÊñá‰ª∂ÂêçÁß∞
      */
      function saveAs(blob, filename) {
        if (window.navigator.msSaveOrOpenBlob) {
          navigator.msSaveBlob(blob, filename);
        } else {
          const link = document.createElement('a');
          const body = document.querySelector('body');

          link.href = window.URL.createObjectURL(blob);
          link.download = filename;

          // fix Firefox
          link.style.display = 'none';
          body.appendChild(link);

          link.click();
          body.removeChild(link);

          window.URL.revokeObjectURL(link.href);
        }
      }

      /**
      * ‰∏ãËΩΩ
      * @param  {String} url ÁõÆÊ†áÊñá‰ª∂Âú∞ÂùÄ
      * @param  {String} filename ÊÉ≥Ë¶Å‰øùÂ≠òÁöÑÊñá‰ª∂ÂêçÁß∞
      */
      function download(url, filename, finishedCallBack) {
        app.progressDialog.filename = filename;
        app.progressDialog.model = true;//ËøõÂ∫¶Êù°Âá∫Áé∞



        getBlob(url).then(blob => {
          finishedCallBack(blob);
          setTimeout(() => { app.progressDialog.model = false; }, 1500)//ËøõÂ∫¶Êù°Ê∂àÂ§±
          saveAs(blob, filename);
        });
      }

      download(url, filename, blob => {
        //ÂÆåÊàêÂêé‰ºöÊâßË°åÁöÑ
        app.$message.success(`Â∑≤ÂÆåÊàê‰∏ãËΩΩ`);
      });
    }
    ,
    initClipboardJS() {

      /*       [
              app.shareThisAppCopyBTN,
              app.bottomSheetCopyBTN,
              app.moreCopyBTN,
              app.bottomSheetIdCopyBTN,
              app.moreIdCopyBTN
            ].forEach(e => {
              e ? e.destroy() : null
            })
       */

      /* var arr = [];
      for (var i in app) {
        arr.push(app[i]);
      }
      console.log(arr); */

      //ÂàÜ‰∫´ÂΩìÂâçÁΩëÂùÄÁöÑÂ§çÂà∂ÊåâÈíÆÂàùÂßãÂåñ
      function init(name, params) {
        var CBN = 'ClipboardBTN_' + name;
        app[CBN] ? app[CBN].destroy() : null
        app[CBN] = new ClipboardJS(document.getElementsByName(name), {
          text: function (trigger) {
            return params.text(trigger);
          }
        }).on('success', function (e) {
          app.copySuccess(params.message ? params.message : 'Â∑≤Â§çÂà∂');
        }).on('error', function (e) {
          console.error(e);
          app.$message.error(e);
        })
      }

      init('shareThisApp', {
        text: () => window.location.href,
        message: 'Â∑≤Â§çÂà∂Êú¨ÁΩëÁ´ôÂú∞ÂùÄ,ËØ∑ÂàÜ‰∫´ÁªôÂ•ΩÂèãÂêß'
      });

      init('copyBTN', {
        text: e => e.getAttribute('copyContent') || app.currentVideo.attributes.copyContent,
        message: 'Â∑≤Â§çÂà∂Áü≠ÈìæÂàÜ‰∫´ÁªÑÂêà'
      });

      init('getID', {
        text: e => e.getAttribute('objectID') || app.currentVideo.id,
        message: 'Â∑≤Â§çÂà∂Êú¨È°πÁõÆÁöÑIDÂè∑'
      });

      init('copyLongURL', {
        text: e => e.getAttribute('copyLongURL') || app.currentVideo.attributes.url,
        message: 'Â∑≤Â§çÂà∂Á∫ØÈïøÈìæ'
      });

      init('copyShortURL', {
        text: e => e.getAttribute('copyShortURL') || app.currentVideo.attributes.shortURL,
        message: 'Â∑≤Â§çÂà∂Á∫ØÁü≠Èìæ'
      });

      /*  //moreÊåâÈíÆÁöÑÂ§çÂà∂ÊåâÈíÆÂàùÂßãÂåñ
       app.moreCopyBTN = new ClipboardJS(document.getElementsByName('copyBTN'), {
         text: function (trigger) {
           return trigger.getAttribute('copyContent') || app.currentVideo.attributes.copyContent
         } 
 
       }).on('success', function (e) {
         // console.log(e);
         app.copySuccess();
       }).on('error', function (e) {
         console.log(e);
       });
       */

      /* //moreÊåâÈíÆÁöÑËé∑ÂèñIDÁöÑÂ§çÂà∂ÊåâÈíÆÂàùÂßãÂåñ
      app.moreIdCopyBTN = new ClipboardJS(document.getElementsByName('getID'), {
        text: function (trigger) {
          // console.log(trigger);
          // console.log(trigger.getAttribute('objectID'));
          return trigger.getAttribute('objectID') || app.currentVideo.id;
        }

      }).on('success', function (e) {
        // console.log(e);
        app.copySuccess();
      }).on('error', function (e) {
        console.log(e);
      }); */

      //bottomSheetÈáåÈù¢ÁöÑÂ§çÂà∂ÊåâÈíÆÂàùÂßãÂåñ
      /*       app.bottomSheetCopyBTN = new ClipboardJS(document.getElementById('Â§çÂà∂Áü≠Èìæ'), {
              text: function (trigger) {
                // return app.makeNewDic(app.currentVideo).attributes.copyContent;
                return app.currentVideo.attributes.copyContent;
      
              }
            }).on('success', function (e) {
              app.copySuccess();
            }).on('error', function (e) {
              console.log(e);
            }); */

      //bottomSheetÈáåÈù¢ÁöÑËé∑ÂèñIDÁöÑÂ§çÂà∂ÊåâÈíÆÂàùÂßãÂåñ
      /*       app.bottomSheetIdCopyBTN = new ClipboardJS(document.getElementById('Ëé∑ÂèñID'), {
              text: function (trigger) {
                return app.currentVideo.id;
              }
            }).on('success', function (e) {
              app.copySuccess();
            }).on('error', function (e) {
              console.log(e);
            });
       */
    },
    expandPanel() {
      this.arrowDegree += 180;
      this.infoPanel = this.infoPanel ? false : true;
    },
    onResize() {
      // console.log({ x: window.innerWidth, y: window.innerHeight });
      this.mobile = this.isMobile();
    },
    isMobile() {
      let flag = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)
      // console.log(flag);
      if (flag) { return true } else { return false }
    },
    keyboardEvent(e) {
      // key.Code === 13Ë°®Á§∫ÂõûËΩ¶ÈîÆ 
      console.log(e);
      // if (e.keyCode === 13) {
      //   //ÈÄªËæëÂ§ÑÁêÜ
      //   this.searchByKeyword({ delay: 0 })
      //   this.$refs.searchBar.blur();
      // }
    },
    closeDpFloat() {
      if (this.bottomSheet == true) {
        this.bottomSheet = false;
      }
    },
    renderSize(value) {
      if (null == value || value == '') {
        return "0 Bytes";
      }
      var unitArr = new Array("Bytes", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB");
      var index = 0,
        srcsize = parseFloat(value);
      index = Math.floor(Math.log(srcsize) / Math.log(1024));
      var size = srcsize / Math.pow(1024, index);
      //  ‰øùÁïôÁöÑÂ∞èÊï∞‰ΩçÊï∞
      size = size.toFixed(2);
      return `${size} ${unitArr[index]}`;
    },
    howToPlay(item) {
      switch (item.attributes.type) {
        case 'ËßÜÈ¢ë':
        case 'Â§ßËßÜÈ¢ë':
          // document.getElementById('dplayer').setAttribute("src", item.shortURL);
          if (this.currentVideo.attributes.name !== item.attributes.name) {//Ê†áÈ¢òË∑ü‰πãÂâçÁöÑ‰∏çÂêåÊâç‰ºöÂàáÊç¢Êñ∞ËßÜÈ¢ëËøõË°åÊí≠Êîæ
            // console.log(item);
            this.currentVideo = item;

            // this.currentVideo.name = item.name;
            // this.currentVideo.shortURL = item.shortURL;
            // this.currentVideo.name_trans = item.name_trans;

            // this.currentVideo.size = item.size;

            var url = item.attributes.expandedURL ? item.attributes.expandedURL : item.attributes.uploaderURL;

            this.currentVideo.attributes.url = url;
            this.dpFloat.notice(`Ê≠£Âú®Âä†ËΩΩ:${item.attributes.name}`, 0, 0.8);
            this.dpFloat.switchVideo({
              url: url,
            });
          }


          this.bottomSheet = true;


          this.dpFloat.on('canplaythrough', function () {
            var dp = window.app.dpFloat;
            if (dp.video.currentTime < 1) {
              dp.notice(`ÊàêÂäüÂä†ËΩΩ!`, 1000, 0.8);
              dp.play();
            }

          });
          break;
        default:
          /* app.snackbar.show = false;
          app.snackbar = {
            show: true,
            color: 'error',
            ripple: false,
            snackbarText: `ÊöÇ‰∏çÊîØÊåÅ„Äé${item.attributes.type}„ÄèÁöÑÈ¢ÑËßà`,
            snackbarIcon: 'report_problem',
            action: () => {
            }
          } */
          app.$message.error(`ÊöÇ‰∏çÊîØÊåÅ„Äé${item.attributes.type}„ÄèÁöÑÈ¢ÑËßà`);
          return
      }
    },
    toggle(index) {
      const i = this.mainList.selected.indexOf(index)

      if (i > -1) {
        this.mainList.selected.splice(i, 1)
      } else {
        this.mainList.selected.push(index)
      }
    },

    pasteFromClipboard() {
      this.paste = !this.paste
    },
    initPlayers() {
      // dplayer-float
      this.dpFloat = new DPlayer({
        container: document.getElementById('dplayer'),
        preload: 'auto',
        autoplay: false,
        screenshot: true,
        video: {
          url: this.v,
        },
        contextmenu: [

          {
            text: 'Áîª‰∏≠Áîª',
            click: (player) => {
              console.log(player);
              currentVideo.requestPictureInPicture();
            }
          },
          {
            text: 'ÂéªÁü≥Â¢®Â∫äÁúãÁúã',
            link: ''
          }
        ],
      });
    },
    getID(id) {
      id = id ? id : this.getUrlVars().id;

      if (id) {
        let query = new AV.Query('ShimoBed');
        query.get(id).then(function (item) {

          var newDic = app.makeNewDic(item);
          // console.log(newDic);

          app.howToPlay(newDic);
          app.initClipboardJS();
        }, function (error) {
          // ÂºÇÂ∏∏Â§ÑÁêÜ
          console.error(error);
        });


        return true;
      } else {
        return false;
      }
    },
    getV(param) {
      var v = param ? param : this.getUrlVars().v;
      if (v) {
        console.log('Ê≠£Âú®Âä†ËΩΩËØ•ËßÜÈ¢ë:' + v);
        this.bottomSheet = true;
        // this.v = v;
        // document.getElementById('dplayer').setAttribute("src", v);
        this.dpFloat.switchVideo({
          url: v,
        });
        return true
      } else {
        return false
      }
    },
    getB(param) {
      var browser = param ? param : this.getUrlVars().b;
      if (browser && !window.navigator.standalone) {
        this.saveDesktopIcon(browser);
      }
    },
    getQ(param) {
      var keyword = param ? param : this.getUrlVars().q;
      if (!keyword) {
        this.keyword = '';
        return false
      }
      else {
        this.keyword = decodeURIComponent(keyword);
        this.searchByKeyword();
        return true
      }
    },
    submit(e) {
      // key.Code === 13Ë°®Á§∫ÂõûËΩ¶ÈîÆ 
      console.log(e);
      if (e.keyCode === 13) {
        //ÈÄªËæëÂ§ÑÁêÜ
        this.searchByKeyword({ delay: 0 })
        this.$refs.searchBar.blur();
      }
    },
    getScrollStyle() {

      return this.scrollStyle = `max-height: ${window.innerHeight - 120}px`
    },
    cutHTTP(input) {
      // return input.replace(/[a-zA-z]+:\/\//g, '');
      return input;
    },
    makeEmoji(suffix) {
      var emoji;

      if (suffix.match(/[a-zA-Z]/g)) {
        if (suffix.match(/mp4|mov|avi/ig)) {//Ê†πÊçÆÂêéÁºÄÁªôÂá∫emoji
          emoji = "üé¨";//Â∏∏ËßÑËßÜÈ¢ëÊñá‰ª∂
        } else if (suffix.match(/webm|mkv|avi/ig)) {
          emoji = "‚ñ∂Ô∏è";//ÊâãÊú∫Êó†Ê≥ïÊí≠ÊîæÁöÑÈùûÂ∏∏ËßÑËßÜÈ¢ëÊñá‰ª∂
        } else if (suffix.match(/mp3|ogg|wav|flac|ape|alca|aac/ig)) {
          emoji = "üéµ";//Èü≥È¢ëÊñá‰ª∂
        } else if (suffix.match(/zip|7z|rar/ig)) {
          emoji = "üì¶";//ÂéãÁº©ÂåÖ
        } else if (suffix.match(/dmg|iso/ig)) {
          emoji = "üíΩ";//ÂÖâÁõòÊò†ÂÉè
        } else if (suffix.match(/ai|psd|aep/ig)) {
          emoji = "üìê";//Â∑•Á®ãÊñá‰ª∂
        } else if (suffix.match(/ppt|pptx|key/ig)) {
          emoji = "üìΩÔ∏è";//ÊºîÁ§∫Êñá‰ª∂
        } else if (suffix.match(/ttf|otf/ig)) {
          emoji = "üî§Ô∏è";//Â≠ó‰ΩìÊñá‰ª∂
        } else if (suffix.match(/doc|pdf/ig)) {
          emoji = "Ô∏èüìÑ";//ÊñáÊ°£
        } else {
          emoji = "‚ùì";//Êú™Áü•Ê†ºÂºè
        }
      } else {
        emoji = suffix;
      }
      return emoji;
    },


    suffixHandle(suffix) {
      suffix = suffix.toLowerCase();
      const fileIndex = {};

      this.fileDescription.forEach((e, index) => {

        e.rule.forEach((type) => fileIndex[type] = this.fileDescription[index])
      });

      if (!fileIndex[suffix]) {
        return {
          emoji: "‚ùì",//Êú™Áü•Ê†ºÂºè
          type: "Êú™Áü•Ê†ºÂºè",
        }
      }

      return {
        emoji: fileIndex[suffix].emoji,
        type: fileIndex[suffix].type,
        canPlay: fileIndex[suffix].canPlay,
      };


      // var arr = [
      //   {
      //     regex: /mp4|mov/ig,
      //     emoji: "üé¨",//Â∏∏ËßÑËßÜÈ¢ëÊñá‰ª∂
      //     type: "ËßÜÈ¢ë",
      //   },
      //   {
      //     regex: /webm|mkv|avi|flv/ig,
      //     emoji: "‚ñ∂Ô∏è",//Â∏∏ËßÑËßÜÈ¢ëÊñá‰ª∂
      //     type: "Â§ßËßÜÈ¢ë",
      //   },
      //   {
      //     regex: /mp3|ogg|wav|flac|ape|alca|aac/ig,
      //     emoji: "üéµ",//Èü≥È¢ëÊñá‰ª∂
      //     type: "Èü≥È¢ë",
      //   },
      //   {
      //     regex: /zip|7z|rar/ig,
      //     emoji: "üì¶",//ÂéãÁº©ÂåÖ
      //     type: "ÂéãÁº©ÂåÖ",
      //   },
      //   {
      //     regex: /dmg|iso/ig,
      //     emoji: "üíΩ",//ÂÖâÁõòÊò†ÂÉè
      //     type: "ÂÖâÁõòÊò†ÂÉè",
      //   },
      //   {
      //     regex: /ai|psd|aep/ig,
      //     emoji: "üìê",//Â∑•Á®ãÊñá‰ª∂
      //     type: "Â∑•Á®ãÊñá‰ª∂",
      //   },
      //   {
      //     regex: /ppt|pptx|key/ig,
      //     emoji: "üìΩÔ∏è",//ÊºîÁ§∫Êñá‰ª∂
      //     type: "ÊºîÁ§∫Êñá‰ª∂",
      //   },
      //   {
      //     regex: /ttf|otf/ig,
      //     emoji: "üî§Ô∏è",//Â≠ó‰ΩìÊñá‰ª∂
      //     type: "Â≠ó‰Ωì",
      //   },
      //   {
      //     regex: /doc|pdf|txt/ig,
      //     emoji: "Ô∏èüìÑ",//ÊñáÊ°£
      //     type: "ÊñáÊ°£",
      //   },
      //   {
      //     regex: /.*/ig,
      //     emoji: "‚ùì",//Êú™Áü•Ê†ºÂºè
      //     type: "Êú™Áü•Ê†ºÂºè",
      //   }
      // ];


      // for (var i = 0; i < arr.length; i++) {
      //   if (suffix.match(arr[i].regex)) {
      //     return {
      //       emoji: arr[i].emoji,
      //       type: arr[i].type,
      //     };
      //   };
      // }


      // if (suffix.match(/[a-zA-Z]/g)) {
      //   if (suffix.match(/mp4|mov/ig)) {//Ê†πÊçÆÂêéÁºÄÁªôÂá∫emoji
      //     regex = /mp4|mov/ig;
      //     emoji = "üé¨";//Â∏∏ËßÑËßÜÈ¢ëÊñá‰ª∂
      //     type = "ËßÜÈ¢ë";
      //   } else if (suffix.match(/webm|mkv|avi|flv/ig)) {
      //     regex = /webm|mkv|avi|flv/ig;
      //     emoji = "‚ñ∂Ô∏è";//ÊâãÊú∫Êó†Ê≥ïÊí≠ÊîæÁöÑÈùûÂ∏∏ËßÑËßÜÈ¢ëÊñá‰ª∂
      //     type = "Â§ßËßÜÈ¢ë";
      //   } else if (suffix.match(/mp3|ogg|wav|flac|ape|alca|aac/ig)) {
      //     regex = /mp3|ogg|wav|flac|ape|alca|aac/ig;
      //     emoji = "üéµ";//Èü≥È¢ëÊñá‰ª∂
      //     type = "Èü≥È¢ë";
      //   } else if (suffix.match(/zip|7z|rar/ig)) {
      //     regex = /zip|7z|rar/ig;
      //     emoji = "üì¶";//ÂéãÁº©ÂåÖ
      //     type = "ÂéãÁº©ÂåÖ";
      //   } else if (suffix.match(/dmg|iso/ig)) {
      //     regex = /dmg|iso/ig;
      //     emoji = "üíΩ";//ÂÖâÁõòÊò†ÂÉè
      //     type = "ÂÖâÁõòÊò†ÂÉè";
      //   } else if (suffix.match(/ai|psd|aep/ig)) {
      //     regex = /ai|psd|aep/ig;
      //     emoji = "üìê";//Â∑•Á®ãÊñá‰ª∂
      //     type = "Â∑•Á®ãÊñá‰ª∂";
      //   } else if (suffix.match(/ppt|pptx|key/ig)) {
      //     regex = /ppt|pptx|key/ig;
      //     emoji = "üìΩÔ∏è";//ÊºîÁ§∫Êñá‰ª∂
      //     type = "ÊºîÁ§∫Êñá‰ª∂";
      //   } else if (suffix.match(/ttf|otf/ig)) {
      //     regex = /ttf|otf/ig;
      //     emoji = "üî§Ô∏è";//Â≠ó‰ΩìÊñá‰ª∂
      //     type = "Â≠ó‰Ωì";
      //   } else if (suffix.match(/doc|pdf|txt/ig)) {
      //     regex = /doc|pdf|txt/ig;
      //     emoji = "Ô∏èüìÑ";//ÊñáÊ°£
      //     type = "ÊñáÊ°£";
      //   } else {
      //     regex = /.*/ig;
      //     emoji = "‚ùì";//Êú™Áü•Ê†ºÂºè
      //     type = "Êú™Áü•Ê†ºÂºè";
      //   }
      // } else {
      //   emoji = suffix;

      // }


    },
    makeNewDic(e) {
      if (!e.id) { return }

      var dic = e.attributes;

      e.attributes.suffix = dic.suffix;//ÂêéÁºÄ

      // console.log(dic.suffix);

      var handle = app.suffixHandle(dic.suffix);

      var emoji = handle.emoji;

      e.attributes.type = handle.type;

      e.attributes.canPlay = handle.canPlay;

      var name = dic.name;

      var shortURL = app.cutHTTP(dic.shortURL);

      var copyContent = `${emoji} ${name} | ${shortURL}`;

      e.attributes.copyContent = copyContent;

      e.attributes.content = emoji + name;//Âú®vueÁöÑtodoÈáåÈù¢content‰ª£Ë°®

      return e;
    },
    makeAList(resp) {
      var result = [];


      app.typeList = [
        {
          size: '20', icon: 'fas fa-globe-americas', text: 'ÂÖ®ÈÉ®', count: 0,
        },
      ];

      const fileIndex = {};

      this.fileDescription.forEach((e, index) => {
        fileIndex[e.type] = { count: 0, subClassArr: [], icon: e.icon, size: e.size };
      });



      resp.forEach(e => {
        var newDic = app.makeNewDic(e);

        fileIndex[newDic.attributes.type].count++;
        fileIndex[newDic.attributes.type].subClassArr.push(newDic);
        app.typeList[0].count++;//‰πüÂ∞±ÊòØ'ÂÖ®ÈÉ®'
        result.push(newDic);
      });

      app.typeList[0].subClassArr = result;//ÂÖ®ÈÉ®ÁöÑsubClassArr

      this.fileDescription.forEach((e, index) => {
        var subClass = fileIndex[e.type];
        app.typeList.push({
          text: e.type,
          count: subClass.count,
          icon: subClass.icon,
          size: subClass.size,
          subClassArr: subClass.subClassArr,
        })

      });


      return result;
    }
    ,
    searchLC: async function (key) {
      var query = new AV.SearchQuery('ShimoBed');//classÂêç
      query.queryString(key);//Ë¶ÅÊêúÁ¥¢ÁöÑÂÖ≥ÈîÆËØç
      var resp = await query.find();
      // console.info(resp);
      //    console.log("ÊâæÂà∞‰∫Ü " + query.hits() + " ‰∏™Êñá‰ª∂.");
      return app.makeAList(resp);
    },
    regularCheckUpdate: async function () {

      const data = this.shimoData;
      console.log(`updateShimoËøîÂõûÁªìÊûúÔºö${this.shimoData}`);

      if (data > 0) {
        /* app.snackbar.show = false;
        app.snackbar = {
          show: true,
          color: 'success',
          ripple: false,
          snackbarText: `Êñ∞Â¢û${data}Êù°ËÆ∞ÂΩï`,
          snackbarIcon: 'mdi-sync',
          action: () => {
    
          }
        }; */
        app.$message.success(`Êñ∞Â¢û${data}Êù°ËÆ∞ÂΩï`);
      } else {
        this.showTop20();

      }

      var query = new AV.Query('ShimoBed');
      query.descending("updatedAt");
      query.limit(this.maxItemsPerPage * (this.hasLoadedPages + 1));//ËØ∑Ê±ÇÊï∞Èáè‰∏äÈôê‰∏∫1000Êù°
      var every = await query.find();

      console.log(every);

      return app.makeAList(every);
      // console.log(results);
    },

    webClipper(matchedURL) {
      console.log('Âç≥Â∞ÜÊâßË°åwebClipper');
      app.loadingDialog = {
        model: true,
        text: 'Ê≠£Âú®ÊëòÊäÑÊÇ®ÊåáÂÆöÁöÑURL'
      };

      AV.Cloud.run('webClipper', {
        url: matchedURL,
      }).then(function (data) {
        // ÊàêÂäü
        console.log(data);
        app.loadingDialog.model = false;
        /* app.snackbar.show = false;
        app.snackbar = {
          show: true,
          color: 'success',
          ripple: false,
          snackbarText: `ÊñáÁ´†Â∑≤‰øùÂ≠òÂà∞Áü≥Â¢®‰∏ä`,
          snackbarIcon: 'mdi-content-save',
          actionText: 'ÁÇπÂáªÊü•Áúã',
          action: () => {
            window.open(data.docURL);
          }
        }; */
        // app.$message.success(`ÊñáÁ´†Â∑≤‰øùÂ≠òÂà∞Áü≥Â¢®‰∏ä`);
        const key = `open${Date.now()}`;
        app.$notification.open({
          message: `ÊñáÁ´†Â∑≤‰øùÂ≠òÂà∞Áü≥Â¢®‰∏ä`,
          description: `Ê†áÈ¢ò:${data.title}`,

          style: {
            width: `${358}px`,
          },
          btn: (h) => {
            return h('a-button', {
              props: {
                type: 'primary',
                size: 'small',
              },
              on: {
                click: () => {
                  app.$notification.close(key);
                  window.open(data.docURL);
                }
              }
            }, 'ÁÇπÂáªÊü•Áúã')
          },
          key,
          onClose: close,
        });
      }, function (error) {
        // Â§±Ë¥•
        console.log(error);
      });


    }
    ,
    searchGlobal: async function (key) {
      var startTime = new Date();
      var results;

      //Â¶ÇÊûú‰∏çÂ≠òÂú®ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÁöÑËØù,Â∞±Áõ¥Êé•ËøõË°åÂ∏∏ËßÑÂä†ËΩΩ(‰πüÂ∞±ÊòØÂä†ËΩΩÊúÄËøë20‰∏™È°πÁõÆ)
      if (!key) {
        results = await this.regularCheckUpdate();
      } else {
        //Â¶ÇÊûúËØÜÂà´‰∏∫ÁΩëÂùÄÁöÑËØù Ê≠£Âàô
        var matchedURLs = key.match(/(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/gm);
        if (matchedURLs) {
          matchedURLs.forEach(eachURL => {
            //Â∞ùËØïËØÜÂà´ÊòØ‰∏çÊòØ58picÁöÑÁΩëÂùÄ,Âπ∂ËØªÂèñÂÖ∂IDÂè∑
            var qiantuURLs = eachURL.match(/((www\.58pic\.com\/newpic\/))([0-9]{8})(\.html)/gm);

            if (qiantuURLs) {
              qiantuURLs.forEach(e => {
                var qiantuID = e.match(/([0-9]{8})/)[0];
                console.log(qiantuID);
                var downloadURL = `http://cdn.52picc.com/qiantu/${qiantuID}.zip?e=1553441694&token=YsxlOcIuU76uwayGqcefhCHsE3FGs14Vv-ePdvBZ:-3V0KLZqtVO3zUhvjYYnZbr2vns=`;
                AV.Cloud.run('getWebTitle',
                  {
                    url: eachURL,
                  }
                ).then(data => {
                  // ÊàêÂäü
                  console.log(data.qiantuTitle);
                  app.$message.success(`Â∞ÜÂî§Ëµ∑‰∏ãËΩΩÂçÉÂõæÁΩëÁ¥†Êùê„Äå${data.qiantuTitle}„Äç`);
                  app.renameDownload(downloadURL, `${data.qiantuTitle}.zip`);
                }).catch(err => {
                  // Â§±Ë¥•
                  console.log(err);
                })

                // window.location.href = `http://cdn.52picc.com/qiantu/${qiantuID}.zip?e=1553441694&token=YsxlOcIuU76uwayGqcefhCHsE3FGs14Vv-ePdvBZ:-3V0KLZqtVO3zUhvjYYnZbr2vns=` 

              })
              return
            }


            //‰∏çÁ¨¶Âêà‰ª•‰∏äÊ≠£ÂàôÊ£ÄÊµã,ÊúÄÁªàÂàô‰ºöËøõË°åÁΩëÈ°µÂâ™Ëóè
            app.webClipper(eachURL);
          })

          return
        }

        //Â¶ÇÊûúËØÜÂà´‰∏∫objectIDÁöÑËØù
        var objectID = key.match(/[0-9a-zA-Z]{24}/gm);
        if (objectID) {
          this.getID(objectID);
          return
        }

        app.keyword = key;
        results = await app.searchLC(key);

        if (results == "") {
          // Vue.toasted.show(`Êâæ‰∏çÂà∞ÂÖ≥‰∫é‚Äú${key}‚ÄùÁöÑÈ°πÁõÆ`, {
          //   position: 'top-center',
          //   theme: 'toasted-primary',//Theme of the toast you prefer['toasted-primary', 'outline', 'bubble']
          //   duration: 3000,
          //   icon: { name: "search" },
          //   iconPack: 'fontawesome',
          //   fitToScreen: "true",
          //   type: "error"//Type of the Toast ['success', 'info', 'error']
          //   // fullWidth:"true",
          // });

          /* app.snackbar.show = false;
          app.snackbar = {
            show: true,
            color: 'error',
            ripple: false,
            snackbarText: `Êâæ‰∏çÂà∞ÂÖ≥‰∫é‚Äú${key}‚ÄùÁöÑÈ°πÁõÆ`,
            snackbarIcon: 'report_problem',
            action: () => {
            }
          } */
          app.$message.error(`Êâæ‰∏çÂà∞ÂÖ≥‰∫é‚Äú${key}‚ÄùÁöÑÈ°πÁõÆ`);
          return
        }

        app.keywordLasttime = key;
      }



      app.resultSumLasttime = results.length;

      app.mainList.results = results;

      var endTime = new Date();
      app.searchDuration = (endTime - startTime) / 1000;//ÊØ´ÁßíËΩ¨ÊàêÁßí

      setTimeout(() => {
        this.initClipboardJS();
      }, 0)
    },
    showLoading(target) {
      target.custom = false;
      target.searchLoading = true;
      setTimeout(() => {
        target.custom = true;
        target.searchLoading = false;
      }, 2000)
    },
    searchDelay(target, delay) {

      target.lastTime = setTimeout(() => {
        var key = target.keyword;
        this.showLoading(target);
        // window.location.href = `?q=${key}`
        // console.log('ÂÖ≥ÈîÆËØç‰∏∫:' + key);
        // bingDic(key);
        app.searchGlobal(key);
      }, delay)
    },
    searchByKeyword(request) {
      var delay = request ? request.delay : 0;
      var target = this;
      if (target.keywordLasttime != target.keyword) {
        target.mainList.results = [];
        // target.keywordLasttime = '';
        if (target.lastTime == 0) {
          this.searchDelay(target, delay);
        } else {
          clearTimeout(target.lastTime);
          this.searchDelay(target, delay);
        }
      }
    },
    getUrlVars() {
      var vars = {};
      var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
        vars[key] = decodeURI(value);
      });
      return vars;
    },
    showTop20() {
      /*       app.snackbar = {
              show: true,
              color: 'info',
              ripple: false,
              snackbarText: 'Â∑≤‰∏∫‰Ω†ÊêúÁ¥¢ÊúÄËøë20Êù°È°πÁõÆ',
              snackbarIcon: 'update',
              action: () => {
      
              }
            } */
      const timer = setInterval(() => {
        if (app.$message) {
          app.$message.success('Â∑≤‰∏∫‰Ω†ÊêúÁ¥¢ÊúÄËøë20Êù°È°πÁõÆ');
          clearInterval(timer);
        }
      }, 100);
    }



  },

})


function process(s, evaluator) {
  var h = Object.create(null), k;
  s.split('').forEach(function (c) {
    h[c] && h[c]++ || (h[c] = 1);
  });
  if (evaluator) for (k in h) evaluator(k, h[k]);
  return h;
};

function continuity(s) {
  var sc = 0, arr = s.split(''), len = s.length;

  for (var i = 0; i < len; i++) {
    for (var j = 1; j < len - i; j++) {
      if (arr[i] == arr[i + j]) {
        sc = sc + j;
      } else { break; }
    }
  }
  return sc / len
}

function entropy(s) {
  var sum = 0, len = s.length;
  process(s, function (k, f) {
    var p = f / len;
    sum -= p * Math.log(p) / Math.log(2);
  });
  return sum;
};


function newEntropy(s) {
  var sum_1 = 0, len = s.length;
  process(s, function (k, f) {
    var p = f / len;
    sum_1 -= p * Math.log(p) / Math.log(2);
  });

  var sum_2 = continuity(s);

  var sum = sum_1 - sum_2 * 2;

  return sum;
};


async function bingDic(word) {

  try {
    var resp = await axios({
      method: 'GET',
      url: "http://xtk.azurewebsites.net/BingDictService.aspx",
      params: { Word: word, Samples: false },
    });
    if (resp.defs != null) {
      var arr;
      resp.defs.forEach(e => {
        arr.push(e.def)
      })
      console.log(arr.join(''));
      return arr.join('')
    }
  } catch (e) {
    console.log(e);
  }


}











//‰ª•‰∏ãÊòØÊñ∞Â¢ûÁöÑDplayerÊí≠ÊîæÁ™óÂè£ÁªÑ‰ª∂







// var log = function (content) {
//   if (!output.innerHTML) {
//     output.innerHTML = content;
//   } else {
//     output.innerHTML += '<br>' + content;
//   }
//   output.scrollTop = 99999;
// };

// var pipWindow, currentVideo;

// currentVideo = dplayer.getElementsByTagName('video')[0];
/*
// console.log(dplayer);
// console.log(dplayer.getElementsByTagName('video')[0]);
currentVideo = dplayer.getElementsByTagName('video')[0];
pipBtn.addEventListener('click', function (event) {
  log('ÂàáÊç¢Picture-in-PictureÊ®°Âºè...');
  // Á¶ÅÁî®ÊåâÈíÆÔºåÈò≤Ê≠¢‰∫åÊ¨°ÁÇπÂáª
  this.disabled = true;
  try {
      if (currentVideo !== document.pictureInPictureElement) {
          // Â∞ùËØïËøõÂÖ•Áîª‰∏≠ÁîªÊ®°Âºè
          currentVideo.requestPictureInPicture();
      } else {
          // ÈÄÄÂá∫Áîª‰∏≠Áîª
          document.exitPictureInPicture();
      }
  } catch (error) {
      log('&gt; Âá∫Èîô‰∫ÜÔºÅ' + error);
  } finally {
      this.disabled = false;
  }
});

// ÁÇπÂáªÂàáÊç¢ÊåâÈíÆÂèØ‰ª•Ëß¶ÂèëÁîª‰∏≠ÁîªÊ®°ÂºèÔºåÂêåÊ†∑ÔºåÂú®Êúâ‰∫õÊµèËßàÂô®‰∏≠ÔºåÂè≥ÈîÆ‰πüÂèØ‰ª•ÂàáÊç¢ÔºåÁîöËá≥ÂèØ‰ª•Ëá™Âä®ËøõÂÖ•Áîª‰∏≠ÁîªÊ®°Âºè
currentVideo.addEventListener('enterpictureinpicture', function (event) {
  log('&gt; ËßÜÈ¢ëÂ∑≤ËøõÂÖ•Picture-in-PictureÊ®°Âºè');
  pipBtn.value = pipBtn.value.replace('ËøõÂÖ•', 'ÈÄÄÂá∫');

  pipWindow = event.pictureInPictureWindow;
  log('&gt; ËßÜÈ¢ëÁ™ó‰ΩìÂ∞∫ÂØ∏‰∏∫Ôºö' + pipWindow.width + ' √ó ' + pipWindow.height);

  // Ê∑ªÂä†resize‰∫ã‰ª∂Ôºå‰∏ÄÂàáÈÉΩÊòØ‰∏∫‰∫ÜÊµãËØïAPI
  pipWindow.addEventListener('resize', onPipWindowResize);
});
// ÈÄÄÂá∫Áîª‰∏≠ÁîªÊ®°ÂºèÊó∂ÂÄô
currentVideo.addEventListener('leavepictureinpicture', function (event) {
  log('&gt; ËßÜÈ¢ëÂ∑≤ÈÄÄÂá∫Picture-in-PictureÊ®°Âºè');
  pipBtn.value = pipBtn.value.replace('ÈÄÄÂá∫', 'ËøõÂÖ•');
  // ÁßªÈô§resize‰∫ã‰ª∂
  pipWindow.removeEventListener('resize', onPipWindowResize);
});
// ËßÜÈ¢ëÁ™óÂè£Â∞∫ÂØ∏ÊîπÂèòÊó∂ÂÄôÊâßË°åÁöÑ‰∫ã‰ª∂
var onPipWindowResize = function (event) {
  log('&gt; Á™óÂè£Â∞∫ÂØ∏ÊîπÂèò‰∏∫Ôºö' + pipWindow.width + ' √ó ' + pipWindow.height);

}
// ÁâπÂæÅÊ£ÄÊµã
if ('pictureInPictureEnabled' in document == false) {
  log('ÂΩìÂâçÊµèËßàÂô®‰∏çÊîØÊåÅËßÜÈ¢ëÁîª‰∏≠Áîª„ÄÇ');
  togglePipButton.disabled = true;
}


console.log($(".dplayer-menu-item:contains('ÂÖ≥‰∫é‰ΩúËÄÖ')").remove());//ÁßªÈô§ÂÖ≥‰∫é‰ΩúËÄÖÁöÑÂè≥ÈîÆÊåâÈíÆ
console.log($(".dplayer-menu-item:contains('DPlayer v1.25.0')").remove());//ÁßªÈô§DPlayerÁâàÊú¨Âè∑ÁöÑÂè≥ÈîÆÊåâÈíÆ

this.dpFloat.fullScreen.request('web');//ÂÖ®Â±èËßÇÁúã */




$(".dplayer-menu-item:contains('ÂÖ≥‰∫é‰ΩúËÄÖ')").remove();//ÁßªÈô§ÂÖ≥‰∫é‰ΩúËÄÖÁöÑÂè≥ÈîÆÊåâÈíÆ
$(".dplayer-menu-item:contains('DPlayer v1.25.0')").remove();//ÁßªÈô§DPlayerÁâàÊú¨Âè∑ÁöÑÂè≥ÈîÆÊåâÈíÆ


